{% include "linkage/header.html" %}
<!-- for "assign" -->
{% load custom_tags %}

<body>

<div id="header">
  {% include "linkage/banner.html" %}
  <ul>
    <li><a href="/linkage">Home</a></li>
    <li><a href="/linkage/test">Test</a></li>
    <li><a href="/linkage/results">Results</a></li>
    <li><a href="/linkage/about">About</a></li>
    <li><a href="/linkage/documentation">Documentation</a></li>
  </ul>
</div>

{% if error_message %}
  <b>No test result, or error message from cli was:</b>
  <pre>
  {{ error_message }}
  </pre>
{% else %}
  <div id="printMe">
  <table hspace = "20" width = "90%" border = "1">
    <tr>
      <td><b>Project: </b>{{ test.project }}</td>
      <td><b>Target: </b>{{ test.target }}</td>
      <td><b>User: </b>{{ test.user }}</td>
      <td><b>Date: </b>{{ test.test_date }}</td>
      <td align = "center">
        <input type="button" name="doprint" value="Print Results" onClick="javascript:void(processPrint())" id="noPrint">
        {% comment %}
        <!-- FIXME - this one prints the header, the one above doesn't print -->
        <input type="button" name="doprint" value="Print Results" onClick="javascript:window.print()" id="noPrint">
        {% endcomment %}
      </td>   
    </tr>
  </table> 
  <br>
  <table hspace = "20" width = "90%" border = "1">
    <tr>
      <td><b>Target</b></td>
      <td><b>Target License</b></td>
      <td><b>Dependency</b></td>
      <td><b>Dependency License</b></td>  
    </tr>

    {% for row in master %}
      <tr valign = "top">
        <td>{{ row.file }}</td>
        <td>{{ row.license }}</td>
        {% autoescape off %}
        <td>{{ row.libs }}</td>
        <td>{{ row.licenses }}</td>
        {% endautoescape %}
      </tr>
    {% endfor %}
  </table>
  </div>
{% endif %}

</body>

<script language="JavaScript">
var gAutoPrint = true;
  
function processPrint(){
    if (document.getElementById != null) {
        var html = '<HTML>\n<HEAD>\n';

        if (document.getElementsByTagName != null) {
            var headTags = document.getElementsByTagName("head");
        }

        if (headTags.length > 0) html += headTags[0].innerHTML;
    }

    html += '\n</HE' + 'AD>\n<BODY>\n';

    var printReadyElem = document.getElementById("printMe");

    if (printReadyElem != null) {
        html += printReadyElem.innerHTML;
    } else {
        alert("Error, no content.");
        return;
    }

    html += '\n</BO' + 'DY>\n</HT' + 'ML>';
    var printWin = window.open("","processPrint");
    printWin.document.open();
    printWin.document.write(html);

    // hide some elements
    var noPrintElem = printWin.document.getElementById("noPrint");
    printWin.noPrintElem.visible = false;
 
    printWin.document.close()
    printWin.focus();
    printWin.print();   
    printWin.close();

    if (gAutoPrint) {
        printWin.print();
    } else {
        alert("Browser not supported.");
    }
}
</script>
